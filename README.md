# BootLoader
A simple system bootloader by assembly language
===================================================================================

汇编语言（第3版）课程设计2

材料：

　　开机后，CPU自动进入到FFFF:0单元处执行，此处有一条跳转指令。CPU执行该指
令后，转去执行BIOS中的硬件系统检测和初始化程序。

    初始化程序将建立BIOS所支持的中断向量，即将BIOS提供的中断例程的入口地址登记在中断向量表中。

　　硬件系统检测和初始化完成后，调用int 19h进行操作系统的引导。
  
　　如果设为从软盘启动操作系统，则int 19h将主要完成以下工作。
  
　　(1)控制0号软驱，读取软盘0道0面1扇区的内容到0:7c00；
  
　　(2)将CS:IP指向0:7c00。
  
　　软盘的0道0面1扇区中装有操作系统引导程序。int 19h将其装到0:7c00处后，设
置CPU从0:7c00开始执行此处的引导程序，操作系统被激活，控制计算机。

　　如果在0号软驱中没有软盘，或发生软盘I/O错误，则int 19h将主要完成以下工作。
  
　　(1)读取硬盘C的0道0面1扇区的内容到0:7c00；
  
　　(2)将CS:IP指向0:7c00。
  
===================================================================================

任务：

　　本课程设计的任务是编写一个可以自行启动计算机，不需要在现有操作系统环境中运行
的程序。程序的功能如下。

　　(1) 列出功能选项，让用户通过键盘进行选择，界面如下。
  
　　    1) reset pc             ；重新启动计算机
      
　　    2) start system         ；引导现有的操作系统
      
　　    3) clock                ；进入时钟程序
      
　　    4) set clock            ；设置时间
      
　　(2) 用户输入“1”后重新启动计算机。
  
　　(3) 用户输入“2”后引导现有的操作系统。
  
　　(4) 用户输入“3”后，执行动态显示当前日期、时间的程序。
  
　　显示格式如下：年/月/日 时:分:秒
  
　　进入此项功能后，一直动态显示当前的时间，在屏幕上将出现时间按秒变化的效果。
  
　　当按下F1键后，改变显示颜色；按下Esc键后，返回到主选单。
  
　　(5) 用户输入“4”后可更改当前的日期、时间，更改后返回到主选单。
  
===================================================================================

环境配置及主要功能实现：

　　本次课程设计是基于VMware WorkStation 15.5.0和Win XP SP3系统完成的，实现了
任务要求的五项功能。

　　首先，需要在虚拟机中为XP系统创建软盘文件，然后在XP系统中编写源程序，并将编写
好的源程序编译、连接后生成exe可执行程序，通过执行该程序，将系统引导程序写入软盘。
在系统开机时，通过配置固件将第一启动项设置为“Removable Devices”，即设置从软盘启动
系统，当系统再次启动时，即执行所写的系统引导程序，显示主选单，根据用户选择，实现相
应功能。

　　引导操作系统启动时，19号中断例程读取软盘0道0面1扇区的内容到0:7c00，然后从
0:7c00处开始执行。由于本课程设计的引导程序的大小大于512字节，一个扇区放不下，所以
需要将其分为两个部分，第一部分存放在1扇区，由19号中断例程调用执行，用于将真正的引
导程序（即第二部分）读取到内存并执行，第二部分从2扇区开始存放，用于实现任务要求的五
项功能和系统引导。在源程序中，将两部分引导代码写入软驱的部分称为安装程序，将存放在1
扇区的部分称为引导程序，将存放在2扇区以后的部分称为主程序。

　　选项1重启计算机，通过将CS:IP设置为FFFF:0实现。
  
　　选项2引导进入现有的操作系统即XP，通过将C盘1扇区的内容读取到0:7c00处，并将
CS:IP设置为0:7c00实现。

    选项3动态显示日期时间，按F1改变显示颜色，通过读取CMOS相应参数的值获取当前的
日期和时间，通过循环读取CMOS实现时间按秒变化的效果。在实现改变颜色时，使用int 16h
的1号功能对键盘缓冲区是否为空先进行判断，只有当键盘缓冲区不为空时，才调用0号功能
读取键盘输入，防止键盘缓冲区为空时调用0号功能导致程序阻塞，时间不变化的问题。

　　选项4更改当前的日期和时间，通过输入12位数字实现更改，前两位表示年，三四位表示
月，五六位表示日，七八位表示时，九十位表示分，最后两位表示秒。能够对用户输入的非数字
字符进行过滤，对输入的长度也有严格的限制，不足之处是没有对每一位数字的大小是否合适进
行判断和限制。

====================================================================================

联系方式：
1550017930@qq.com

参考链接：
https://blog.csdn.net/m0_48836226/article/details/120718381

https://blog.csdn.net/shaco_/article/details/105662512

https://blog.csdn.net/qq_43573781/article/details/105542499

====================================================================================
